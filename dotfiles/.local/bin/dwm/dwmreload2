#!/usr/bin/env bash
# A script to get colours from xrdb & deploy it to polybar, alacritty & rofi.

DIR="$HOME/.config"

xrdb -load ~/.Xresources

getcolors () {
	foreground="$(xrdb -query | grep '*foreground:'| awk '{print $NF}')"
	background="$(xrdb -query | grep '*background:'| awk '{print $NF}')"
	cursorColor="$(xrdb -query | grep '*cursorColor:'| awk '{print $NF}')"
	
	black="$(xrdb -query | grep '*color0:'| awk '{print $NF}')"	
	alt_black="$(xrdb -query | grep '*alt_black:'| awk '{print $NF}')"
	red="$(xrdb -query | grep '*color1:'| awk '{print $NF}')"
	alt_red="$(xrdb -query | grep '*alt_red:'| awk '{print $NF}')"
	green="$(xrdb -query | grep '*color2:'| awk '{print $NF}')"
	alt_green="$(xrdb -query | grep '*alt_green:'| awk '{print $NF}')"
	yellow="$(xrdb -query | grep '*color3:'| awk '{print $NF}')"
	alt_yellow="$(xrdb -query | grep '*alt_yellow:'| awk '{print $NF}')"
	blue="$(xrdb -query | grep '*color4:'| awk '{print $NF}')"
	alt_blue="$(xrdb -query | grep '*alt_blue:'| awk '{print $NF}')"
	magenta="$(xrdb -query | grep '*color5:'| awk '{print $NF}')"
	alt_magenta="$(xrdb -query | grep '*alt_magenta:'| awk '{print $NF}')"
	cyan="$(xrdb -query | grep '*color6:'| awk '{print $NF}')"
	alt_cyan="$(xrdb -query | grep '*alt_cyan:'| awk '{print $NF}')"
	white="$(xrdb -query | grep '*color7:'| awk '{print $NF}')"
	alt_white="$(xrdb -query | grep '*alt_white:'| awk '{print $NF}')"
	orange="$(xrdb -query | grep '*color16:'| awk '{print $NF}')"
	alt_orange="$(xrdb -query | grep '*alt_orange:'| awk '{print $NF}')"
	alt_red1="$(xrdb -query | grep '*color17:'| awk '{print $NF}')"
	
	mix_black="$(xrdb -query | grep '*color0:'| awk '{print $NF}')"	
	orginal_black="$(xrdb -query | grep '*color8:'| awk '{print $NF}')"	
	material_black"$(xrdb -query | grep '*Black_Color:'| awk '{print $NF}')"
	
	mix_red="$(xrdb -query | grep '*color1:'| awk '{print $NF}')"	
	orginal_red="$(xrdb -query | grep '*color9:'| awk '{print $NF}')"	
	material_red"$(xrdb -query | grep '*Red_Color:'| awk '{print $NF}')"
	
	mix_green="$(xrdb -query | grep '*color2:'| awk '{print $NF}')"	
	orginal_green="$(xrdb -query | grep '*color10:'| awk '{print $NF}')"	
	material_green"$(xrdb -query | grep '*Green_Color:'| awk '{print $NF}')"
	
	mix_yellow="$(xrdb -query | grep '*color3:'| awk '{print $NF}')"	
	orginal_yellow="$(xrdb -query | grep '*color11:'| awk '{print $NF}')"	
	material_yellow"$(xrdb -query | grep '*Yellow_Color:'| awk '{print $NF}')"
	
	mix_blue="$(xrdb -query | grep '*color4:'| awk '{print $NF}')"	
	orginal_blue="$(xrdb -query | grep '*color12:'| awk '{print $NF}')"	
	material_blue"$(xrdb -query | grep '*Blue_Color:'| awk '{print $NF}')"
	
	mix_purple="$(xrdb -query | grep '*color5:'| awk '{print $NF}')"	
	orginal_purple="$(xrdb -query | grep '*color13:'| awk '{print $NF}')"	
	material_purple"$(xrdb -query | grep '*Purple_Color:'| awk '{print $NF}')"
	
	mix_aqua="$(xrdb -query | grep '*color6:'| awk '{print $NF}')"	
	orginal_aqua="$(xrdb -query | grep '*color14:'| awk '{print $NF}')"	
	material_aqua"$(xrdb -query | grep '*Aqua_Color:'| awk '{print $NF}')"
	
	mix_white="$(xrdb -query | grep '*color7:'| awk '{print $NF}')"	
	orginal_white="$(xrdb -query | grep '*color15:'| awk '{print $NF}')"	
	material_white"$(xrdb -query | grep '*White_Color:'| awk '{print $NF}')"
	
	material_orange="$(xrdb -query | grep '*Orange_Color:'| awk '{print $NF}')"
	mix_orange="$(xrdb -query | grep '*Dark_Orange_Color:'| awk '{print $NF}')"
	
	border_Color="$(xrdb -query | grep '*Border_Color:'| awk '{print $NF}')"
}
getcolors



dwmbar () {
	cat > $DIR/polybar/color <<- EOF	
	[color]

	FOREGROUND = ${foreground}
	BACKGROUND = ${background}
	BLACK = ${BLACK}
	RED = ${RED}
	green = ${green}
	YELLOW = ${YELLOW}
	BLUE = ${BLUE}
	MAGENTA = ${MAGENTA}
	CYAN = ${CYAN}
	WHITE = ${WHITE}
	ALTBLACK = ${ALTBLACK}
	ALTRED = ${ALTRED}
	ALTGREEN = ${ALTGREEN}
	ALTYELLOW = ${ALTYELLOW}
	ALTBLUE = ${ALTBLUE}
	ALTMAGENTA = ${ALTMAGENTA}
	ALTCYAN = ${ALTCYAN}
	ALTWHITE = ${ALTWHITE}
	EOF
}
#dwmbar

dwmterm () {
	cat > "$DIR"/alacritty/colors.yml <<- _EOF_
		## Colors configuration
		colors:
		  # Default colors
		  primary:
		    background: '${background}'
		    foreground: '${foreground}'

		  # Normal colors
		  normal:
		    black:   '${black}'
		    red:     '${red}'
		    green:   '${green}'
		    yellow:  '${yellow}'
		    blue:    '${blue}'
		    magenta: '${magenta}'
		    cyan:    '${cyan}'
		    white:   '${white}'

		  # Bright colors
		  bright:
		    black:   '${alt_black}'
		    red:     '${alt_red}'
		    green:   '${alt_green}'
		    yellow:  '${alt_yellow}'
		    blue:    '${alt_blue}'
		    magenta: '${alt_magenta}'
		    cyan:    '${alt_cyan}'
		    white:   '${alt_white}'
	_EOF_
}
#dwmterm

dwmrofi () {
	cat > $DIR/rofi/themes/colors.rasi <<- EOF	
	* {
		background:			${backgroundColor};
		foreground:			${foregroundColor};
		selected:			${blue};
		urgent:				${red};
		on:					${green};
		off:				${red};
		
		border:				${borderColor};
		se:      			${backgroundColor};
		fg:      			${foregroundColor};
		ac:      			${orange};
		red:     			${alt_red};
		green:   			${alt_green};
		yellow:  			${alt_yellow};
		blue:    			${alt_blue};
		purple:  			${alt_magenta};
		cyan:    			${alt_cyan};
		}
	EOF
}
#dwmrofi

dwmcolors () {
	sed -i -e "s/dwm.normfgcolor:.*/dwm.normfgcolor:$foreground/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.normbgcolor:.*/dwm.normbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.normbordercolor:.*/dwm.normbordercolor:$borderColor/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.normfloatcolor:.*/dwm.normfloatcolor:$black/" ~/.Xresources.d/dwm.xresources
	
	sed -i -e "s/dwm.selfgcolor:.*/dwm.selfgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.selbgcolor:.*/dwm.selbgcolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.selbordercolor:.*/dwm.selbordercolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.selfloatcolor:.*/dwm.selfloatcolor:$red/" ~/.Xresources.d/dwm.xresources
	
	sed -i -e "s/dwm.titlenormfgcolor:.*/dwm.titlenormfgcolor:$foreground/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titlenormbgcolor:.*/dwm.titlenormbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titlenormbordercolor:.*/dwm.titlenormbordercolor:$borderColor/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titlenormfloatcolor:.*/dwm.titlenormfloatcolor:$borderColor/" ~/.Xresources.d/dwm.xresources

	sed -i -e "s/dwm.titleselfgcolor:.*/dwm.titleselfgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titleselbgcolor:.*/dwm.titleselbgcolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titleselbordercolor:.*/dwm.titleselbordercolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.titleselfloatcolor:.*/dwm.titleselfloatcolor:$red/" ~/.Xresources.d/dwm.xresources

	sed -i -e "s/dwm.tagsnormfgcolor:.*/dwm.tagsnormfgcolor:$foreground/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsnormbgcolor:.*/dwm.tagsnormbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsnormbordercolor:.*/dwm.tagsnormbordercolor:$alt_borderColor/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsnormfloatcolor:.*/dwm.tagsnormfloatcolor:$yellow/" ~/.Xresources.d/dwm.xresources

	sed -i -e "s/dwm.tagsselfgcolor:.*/dwm.tagsselfgcolor:$foreground/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsselbgcolor:.*/dwm.tagsselbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsselbordercolor:.*/dwm.tagsselbordercolor:$alt_borderColor/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.tagsselfloatcolor:.*/dwm.tagsselfloatcolor:$red/" ~/.Xresources.d/dwm.xresources

	sed -i -e "s/dwm.hidnormfgcolor:.*/dwm.hidnormfgcolor:$borderColor/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.hidselfgcolor:.*/dwm.hidselfgcolor:$yellow/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.hidnormbgcolor:.*/dwm.hidnormbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.hidselbgcolor:.*/dwm.hidselbgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources

	sed -i -e "s/dwm.urgfgcolor:.*/dwm.urgfgcolor:$alt_black/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.urgbgcolor:.*/dwm.urgbgcolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.urgbordercolor:.*/dwm.urgbordercolor:$red/" ~/.Xresources.d/dwm.xresources
	sed -i -e "s/dwm.urgfloatcolor:.*/dwm.urgfloatcolor:$red/" ~/.Xresources.d/dwm.xresources
}
dwmcolors


dwmdunst () {
	cat > "$DIR/dunst"/sid <<- _EOF_
		Dark
	_EOF_
	
	sed -i '/urgency_low/Q' "$DIR/dunst"/dunstrc
	cat >> "$DIR/dunst"/dunstrc <<- _EOF_
		[urgency_low]
		timeout = 2
		background = "${backgroundColor}"
		foreground = "${foregroundColor}"
		frame_color = "${blue}"

		[urgency_normal]
		timeout = 5
		background = "${backgroundColor}"
		foreground = "${foregroundColor}"
		frame_color = "${blue}"

		[urgency_critical]
		timeout = 0
		background = "${background}"
		foreground = "${red}"
		frame_color = "${red}"
	_EOF_
	
	pkill dunst && dunst &
}
#dwmdunst

sleep 1s

randomize_color(){
	rcolor="red"
	dir="$HOME/.Xresources.d/color"
	
	rcolors=($(ls -p $dir))
	rcolor="${rcolors[$(( $RANDOM % 5 ))]}"
	#apply random color

	/home/fewcm/.Xresources.d/color/$rcolor
}
#randomize_color

merge() {
	xrdb -merge ~/.Xresources
}

uireload() {
	merge | dwmc xrdb | kill -HUP $(pidof dwm)
}
uireload


