#!/usr/bin/env bash
# Rofi menu for quickly editing a file in some directory
# Requires ripgrep
# I use it for editing dotfiles in my ~/.config directory

# Directory to search in
dir="$HOME"
# Ignore files or directories relative to the directory you want to search
ignore="
Music/*
Downloads/*
Documents/*
Projects/*
.vim/
suckless/dmenu
.config/autostart
.config/backintime
.config/bashtop
.config/bleachbit
.config/blockify
.config/calcurse
.config/citra-emu
.config/cmst
.config/composer
.config/configstore
.config/czkawka
.config/dconf
.config/dunst
.config/easytag
.config/Electron
.config/fcitx
.config/fcitx5
.config/FireDM
.config/flavours
.config/fontforge
.config/font-manager
.config/go
.config/goa-1.0
.config/google-chrome
.config/google-chrome-beta
.config/google-chrome-beta-back-ovfs
.config/google-chrome-beta-backup
.config/google-chrome-dev
.config/gtk-2.0
.config/gtk-3.0
.config/htop
.config/ibus
.config/indicator-sound-switcher.json
.config/inkscape
.config/keepassxc
.config/Kvantum
.config/menus
.config/microsoft-edge-*
.config/mpd
.config/mpDris2
.config/mpv
.config/ncmpcpp
.config/nemo
.config/neofetch
.config/nvim
.config/oomox
.config/psd
.config/pulse
.config/qt5ct
.config/qt6ct
.config/QtProject.conf
.config/ranger
.config/Skype
.config/skypeforlinux
.config/spicetify
.config/spotify
.config/systemd
.config/Thunar
.config/transmission
.config/user-dirs.dirs
.config/user-dirs.locale
.config/viewnior
.config/vlc
.config/xfce4
.config/yay
"

ignore_file="/tmp/rofi_edit_ignore_file"
# Write ignore file in tmpfs
echo "$ignore" > "$ignore_file"

# Rofi prompt
rofi_prompt="Edit dotfile"

# Change directory so that the paths are shorter in rofi
cd "$dir" || exit
choice="$(rg --files  --hidden --color=never --ignore-file "$ignore_file" | rofi -no-disable-history -sort -i -p "$rofi_prompt" -dmenu -fuzzy -theme  ~/.config/rofi/themes/launcher.rasi)"

# If the search is cancelled by the user (e.g. Escape button)
if [[ -z "${choice// }" ]]; then
    exit 1
fi

# Edit the selected file
st -e nvim "$choice"
